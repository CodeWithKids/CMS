import{Z as R,_ as X,$ as U,a0 as H,r as d,j as e,B as x,L as _,h as u,a1 as V,R as ee,W as se,a2 as te,a3 as ae,a4 as ne,a5 as re,a6 as de,a7 as W,a8 as oe,a9 as ie,aa as le,ab as ce,ac as me,ad as xe,ae as ue,af as he,ag as pe,ah as ge,S as g,A as je,C as P,e as Ne,f as fe,ai as be,aj as ye,ak as z}from"./index-C7xgdnS2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=R("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=R("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=R("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),we={not_started:"Pending",draft:"Draft",ready:"Ready"};function I({session:t,currentUser:a,lessonPlanStatus:j,attendanceStatus:l,reportStatus:N,expensesStatus:f,hasDeviceCheckedOut:k}){const r=X(t.classId),b=U(t,a),{getNotesForSession:S,addNote:C,deleteNote:D}=H(),[A,w]=d.useState(!1),[h,y]=d.useState(""),c=S(t.id),v=()=>{const o=h.trim();o&&(C(t.id,o),y(""))};return e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 flex flex-col gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mb-1",children:[e.jsx("p",{className:"font-medium text-sm",children:r==null?void 0:r.name}),b&&e.jsx("span",{className:`inline-flex px-1.5 py-0.5 rounded text-xs font-medium ${b==="facilitator"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"}`,children:b==="facilitator"?"Facilitator":"Coach"}),k&&e.jsx("span",{className:"inline-flex items-center gap-0.5 text-xs text-muted-foreground",title:"You have a device checked out",children:e.jsx(K,{className:"w-3.5 h-3.5"})}),e.jsxs(x,{variant:"ghost",size:"icon",className:"h-7 w-7 ml-auto shrink-0",onClick:()=>w(!0),title:"Notes",children:[e.jsx(B,{className:`w-3.5 h-3.5 ${c.length>0?"text-primary":"text-muted-foreground"}`}),c.length>0&&e.jsxs("span",{className:"sr-only",children:[c.length," note(s)"]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.date," · ",t.startTime,"–",t.endTime," · ",(r==null?void 0:r.location)??""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_[t.learningTrack]??t.learningTrack}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.jsxs("span",{className:"inline-flex px-1.5 py-0.5 rounded text-[10px] bg-muted",children:["Lesson: ",we[j]]}),e.jsxs("span",{className:`inline-flex px-1.5 py-0.5 rounded text-[10px] ${l==="done"?"bg-green-500/15 text-green-700 dark:text-green-400":"bg-muted"}`,children:["Attendance: ",l==="done"?"Done":"Pending"]}),e.jsxs("span",{className:`inline-flex px-1.5 py-0.5 rounded text-[10px] ${N==="submitted"?"bg-green-500/15 text-green-700 dark:text-green-400":"bg-muted"}`,children:["Report: ",N==="submitted"?"Submitted":"Pending"]}),e.jsxs("span",{className:`inline-flex px-1.5 py-0.5 rounded text-[10px] ${f==="logged"?"bg-green-500/15 text-green-700 dark:text-green-400":"bg-muted"}`,children:["Expenses: ",f==="logged"?"Logged":"Pending"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 shrink-0",children:[e.jsx(u,{to:`/educator/sessions/${t.id}/lesson-plan`,children:e.jsxs(x,{size:"sm",variant:"outline",className:"touch-manipulation",children:[e.jsx(V,{className:"w-4 h-4 mr-1"})," Lesson plan"]})}),e.jsx(u,{to:`/educator/sessions/${t.id}/attendance`,children:e.jsxs(x,{size:"sm",variant:l==="pending"?"default":"outline",className:"touch-manipulation",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"})," Attendance"]})}),e.jsx(u,{to:`/educator/sessions/${t.id}/report`,children:e.jsxs(x,{size:"sm",variant:"outline",className:"touch-manipulation",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"})," Report"]})}),e.jsx(u,{to:`/educator/sessions/${t.id}/expenses`,children:e.jsxs(x,{size:"sm",variant:"outline",className:"touch-manipulation",children:[e.jsx(se,{className:"w-4 h-4 mr-1"})," Expenses"]})})]}),e.jsx(te,{open:A,onOpenChange:w,children:e.jsxs(ae,{className:"max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"})," Notes"]}),e.jsxs(de,{children:[r==null?void 0:r.name," · ",t.date," ",t.startTime,"–",t.endTime]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"Add a note or reminder...",value:h,onChange:o=>y(o.target.value),onKeyDown:o=>o.key==="Enter"&&(o.preventDefault(),v())}),e.jsx(x,{size:"sm",onClick:v,disabled:!h.trim(),children:"Add"})]}),e.jsx("ul",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:c.length===0?e.jsx("li",{className:"text-sm text-muted-foreground",children:"No notes yet."}):c.map(o=>e.jsxs("li",{className:"rounded border bg-muted/30 p-2 text-sm flex justify-between gap-2",children:[e.jsx("span",{className:"min-w-0 break-words",children:o.text}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(o.createdAt).toLocaleString()}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>D(t.id,o.id),title:"Delete note",children:"×"})]})]},o.id))})]})]})})]})}const m=new Date().toISOString().split("T")[0];function ke(t){const a=t.getDay(),j=t.getDate()-(a===0?6:a-1),l=new Date(t);return l.setDate(j),l.toISOString().split("T")[0]}function Ce(){const{currentUser:t}=oe(),a=(t==null?void 0:t.id)??"",{getBySession:j}=ie(),{getBySession:l}=le(),{getExpenseBySessionAndEducator:N}=ce(),{getInstanceForSession:f}=me(),{getItemsCheckedOutTo:k}=xe(),{getSessionsForEducatorByRole:r,getSessionsForClass:b}=ue(),{getNotesForDate:S,addNoteForDate:C}=H(),D=d.useMemo(()=>r(a,{date:m}),[a,r]),A=d.useMemo(()=>r(a,{from:m}).filter(s=>s.date>m).slice(0,10),[a,r]),w=d.useMemo(()=>r(a,{past:!0}).slice(0,5),[a,r]),h=d.useMemo(()=>ke(new Date),[]),y=d.useMemo(()=>r(a,{from:h,to:m}).filter(s=>{var n;return((n=l(s.id))==null?void 0:n.status)!=="submitted"}),[a,h,l,r]),c=y.length,v=d.useMemo(()=>he.filter(s=>s.educatorId===a||r(a,{from:"2000-01-01",to:"2099-12-31"}).some(n=>n.classId===s.id&&(n.leadEducatorId===a||(n.assistantEducatorIds??[]).includes(a)))),[a,r]),o=d.useMemo(()=>{const s=pe();return s?{from:s.startDate,to:s.endDate}:{from:h,to:m}},[h]),E=d.useMemo(()=>{const s=r(a,{from:o.from,to:o.to});let n=0,i=0;for(const p of s)p.leadEducatorId===a?n+=p.durationHours??1:(p.assistantEducatorIds??[]).includes(a)&&(i+=p.durationHours??1);return{facilitating:n,coaching:i,sessionCount:s.length,classCount:new Set(s.map(p=>p.classId)).size}},[a,o,r]),T=d.useMemo(()=>k(a),[k,a]),$=d.useMemo(()=>r(a,{from:"2000-01-01",to:"2099-12-31"}),[a,r]),F=d.useMemo(()=>ge(a,$),[a,$]),Y=d.useMemo(()=>{const s=new Map;for(const n of v){const i=b(n.id),p=[...new Set(i.map(J=>J.learningTrack))];s.set(n.id,p)}return s},[v,b]),[Z,q]=d.useState(!1),[G,Q]=d.useState(!0),[L,M]=d.useState(""),O=d.useMemo(()=>S(m),[m,S]);return d.useEffect(()=>{const s=setTimeout(()=>Q(!1),200);return()=>clearTimeout(s)},[]),G?e.jsxs("div",{className:"page-container",children:[e.jsx(g,{className:"h-9 w-56 mb-2"}),e.jsx(g,{className:"h-5 w-48 mb-6"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsx(g,{className:"h-20"}),e.jsx(g,{className:"h-20"}),e.jsx(g,{className:"h-20"}),e.jsx(g,{className:"h-20"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(g,{className:"h-64"}),e.jsx(g,{className:"h-64"})]})]}):e.jsxs("div",{className:"page-container",children:[e.jsx("h1",{className:"page-title",children:"Educator Dashboard"}),e.jsxs("p",{className:"page-subtitle",children:["Welcome back, ",t==null?void 0:t.name]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Your classes and devices are below."}),Z&&e.jsxs(je,{variant:"destructive",className:"mb-4",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx(Ne,{children:"Something went wrong"}),e.jsxs(fe,{children:["We couldn’t load your dashboard."," ",e.jsx(x,{variant:"link",className:"p-0 h-auto font-medium",onClick:()=>q(!1),children:"Try again"})]})]}),c>0&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg border bg-amber-500/10 border-amber-500/30 flex items-center gap-2 text-sm flex-wrap",children:[e.jsx(P,{className:"w-4 h-4 text-amber-600 shrink-0"}),e.jsxs("span",{children:["You still have ",c," session",c!==1?"s":""," without reports. Sessions are not complete until the report is submitted."]}),y[0]&&e.jsx(u,{to:`/educator/sessions/${y[0].id}/report`,className:"text-primary hover:underline font-medium shrink-0",children:"Fill session report"})]}),e.jsxs("div",{className:"mb-6 p-4 rounded-xl border bg-card grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Facilitating (this term)"}),e.jsxs("p",{className:"text-xl font-semibold",children:[E.facilitating,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Coaching (this term)"}),e.jsxs("p",{className:"text-xl font-semibold",children:[E.coaching,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Sessions"}),e.jsx("p",{className:"text-xl font-semibold",children:E.sessionCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Classes"}),e.jsx("p",{className:"text-xl font-semibold",children:E.classCount})]})]}),F.length>0&&e.jsxs("div",{className:"mb-6 p-4 rounded-xl border bg-card",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-3",children:[e.jsx(be,{className:"w-5 h-5 text-amber-500"})," Your badges"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:F.map(s=>e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-lg bg-amber-500/10 text-amber-800 dark:text-amber-200 border border-amber-500/20 text-sm font-medium",title:s.description,children:s.name},s.id))}),e.jsx(u,{to:"/educator/profile",className:"text-sm text-primary hover:underline mt-2 inline-block",children:"View all on profile →"})]}),e.jsxs("div",{className:"mb-6 p-4 rounded-xl border bg-card",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-3",children:[e.jsx(B,{className:"w-5 h-5 text-primary"})," Today's notes"]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Quick reminders or notes for today. Session-specific notes are on each session card."}),O.length>0&&e.jsx("ul",{className:"space-y-2 mb-3",children:O.map(s=>e.jsx("li",{className:"text-sm rounded-md bg-muted/50 px-3 py-2 whitespace-pre-wrap",children:s.text},s.id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"Add a note or reminder for today...",value:L,onChange:s=>M(s.target.value),onKeyDown:s=>{if(s.key==="Enter"&&!s.shiftKey){s.preventDefault();const n=L.trim();n&&(C(m,n),M(""))}},className:"flex-1"}),e.jsx(x,{type:"button",variant:"secondary",onClick:()=>{const s=L.trim();s&&(C(m,s),M(""))},children:"Add"})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"bg-card rounded-xl border p-5",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ye,{className:"w-5 h-5 text-accent"})," Today's sessions"]}),D.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No sessions today."}):e.jsx("div",{className:"space-y-3",children:D.map(s=>{var n,i;return e.jsx(I,{session:s,currentUser:t,lessonPlanStatus:((n=f(s.id))==null?void 0:n.status)??"not_started",attendanceStatus:j(s.id).length>0?"done":"pending",reportStatus:((i=l(s.id))==null?void 0:i.status)??"pending",expensesStatus:N(s.id,a)?"logged":"pending",hasDeviceCheckedOut:T.length>0},s.id)})})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-5",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-primary"})," Upcoming sessions"]}),A.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming sessions."}):e.jsx("div",{className:"space-y-3",children:A.map(s=>{var n,i;return e.jsx(I,{session:s,currentUser:t,lessonPlanStatus:((n=f(s.id))==null?void 0:n.status)??"not_started",attendanceStatus:j(s.id).length>0?"done":"pending",reportStatus:((i=l(s.id))==null?void 0:i.status)??"pending",expensesStatus:N(s.id,a)?"logged":"pending",hasDeviceCheckedOut:T.length>0},s.id)})})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-5",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-primary"})," Past sessions"]}),w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No past sessions."}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{var n,i;return e.jsx(I,{session:s,currentUser:t,lessonPlanStatus:((n=f(s.id))==null?void 0:n.status)??"not_started",attendanceStatus:j(s.id).length>0?"done":"pending",reportStatus:((i=l(s.id))==null?void 0:i.status)??"pending",expensesStatus:N(s.id,a)?"logged":"pending",hasDeviceCheckedOut:!1},s.id)})})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-5",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-4",children:[e.jsx(K,{className:"w-5 h-5 text-primary"})," My devices"]}),T.length>0?e.jsx("ul",{className:"space-y-2",children:T.map(s=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-muted-foreground",children:[s.checkedOutAt?new Date(s.checkedOutAt).toLocaleDateString("en-ZA"):"—",s.dueAt&&` · Due ${new Date(s.dueAt).toLocaleDateString("en-ZA")}`]}),e.jsx(u,{to:`/inventory/${s.id}`,className:"text-primary hover:underline text-sm",children:"View"})]},s.id))}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"No devices checked out."}),e.jsx(u,{to:"/inventory",className:"text-sm text-primary hover:underline mt-2 inline-block",children:"Browse inventory →"})]})]}),e.jsxs("div",{className:"bg-card rounded-xl border p-5",children:[e.jsxs("h2",{className:"font-semibold flex items-center gap-2 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-primary"})," My Classes"]}),e.jsx("div",{className:"space-y-3",children:v.map(s=>{const n=Y.get(s.id)??[];return e.jsxs(u,{to:`/educator/classes/${s.id}`,className:"block p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.program," · ",s.ageGroup," · ",s.location]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.learnerIds.length," learners",n.length>0&&e.jsxs("span",{className:"ml-1",children:["· Tracks: ",n.map(i=>_[i]??i).join(", ")]})]})]},s.id)})})]})]})}export{Ce as default};
